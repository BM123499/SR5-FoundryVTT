<form class="chummer-import" autocomplete="off" onsubmit="event.preventDefault()">
    <header class="header-row">
        <h1>Chummer Data Import</h1>
        <button
            type="button"
            class="importOptionsBtn {{#if isImporting}}disabled{{/if}}"
            {{#if isImporting}}disabled{{/if}}
            title="Import Settings"
        >‚öôÔ∏è</button>
    </header>

    <section class="import-container">
        <p>
            You can import Chummer5a XML data in two ways:
        </p>
        <ul>
            <li><b>Quick Import</b> ‚Äî Downloads the latest fully supported data directly from the official repository (approx. <b>7 MB</b>).</li>
            <li><b>Import from ZIP</b> ‚Äî Use a <code>.zip</code> of your local Chummer5a <code>data</code> folder (custom or different versions).</li>
        </ul>
        <p>
            Includes all core game data: weapons, armor, vehicles, spells, critters, gear, and more.
            Only the latest supported version is guaranteed to work without issues.
        </p>

        <div class="import-grid">
            <div class="cell empty"></div>
            <div class="cell">
                <!-- ZIP File Selector -->
                <div class="file-input-wrapper">
                    <input type="file" id="zipFileInput" class="filedatadrop" accept=".zip,application/zip" style="display: none;" />
                    <label for="zipFileInput" class="file-input-label">
                        {{#if zipFileName}}
                            <span>Selected: <b>{{zipFileName}}</b></span>
                        {{else}}
                            <span>Click to Select .zip File</span>
                        {{/if}}
                    </label>
                </div>
            </div>
            <div class="cell">
                <button
                    name="quick-import"
                    type="submit"
                    id="quickImportBtn"
                    class="{{#if isImporting}}disabled{{/if}}"
                    {{#if isImporting}}disabled{{/if}}
                >
                    ‚¨áÔ∏è Quick Import
                </button>
            </div>
            <div class="cell">
                <button
                    name="import"
                    type="submit"
                    id="advanceImportBtn"
                    class="{{#unless zipFileName}}disabled{{/unless}} {{#if isImporting}}disabled{{/if}}"
                    {{#unless zipFileName}}disabled{{/unless}} {{#if isImporting}}disabled{{/if}}
                >
                    üìÇ Import from ZIP
                </button>
            </div>
        </div>
    </section>
</form>

<div class="import-options-modal {{#if showImportOptions}}show{{else}}hidden{{/if}}">
    <div class="import-options-content">
        <header class="modal-header">
            <h2>Import Settings</h2>
        </header>

        <div class="modal-body">
            <h3>General Options</h3>
            <div class="other-settings-grid">
                <label>
                    <input type="checkbox" class="setIcons" {{#if icons}}checked{{/if}} />
                    Enable automatic icon assignment for items.
                </label>
                <label>
                    <input type="checkbox" class="deleteCompendiums" {{#if deleteCompendiums}}checked{{/if}} />
                    Clear all previously imported data first.
                </label>
            </div>
            <h3>Source Books to Import</h3>
            <div class="book-options-actions">
                <button type="button" class="bookSelectAllBtn">Select All</button>
                <button type="button" class="bookUnselectAllBtn">Unselect All</button>
                <button type="button" class="bookDefaultsBtn">Restore Defaults</button>
            </div>
            <div class="book-checkbox-grid">
                {{#each shadowrunBooks}}
                    <label>
                        <input type="checkbox" class="bookOption" data-book="{{this.code}}" {{#if this.value}}checked{{/if}} />
                        {{this.name}}
                    </label>
                {{/each}}
            </div>
        </div>

        <footer class="modal-footer">
            <button type="button" class="closeOptionsBtn">Save & Close</button>
        </footer>
    </div>
</div>

<style>
    /* --- Main Form & Layout --- */
    .chummer-import { font-family: sans-serif; }
    .chummer-import .header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid var(--color-underline-header);
        padding-bottom: 0.25em;
    }
    .chummer-import h1 { margin: 0; border-bottom: 0; }
    /* MODIFIED: Reduced gear icon font size and adjusted padding for better proportions */
    .chummer-import .importOptionsBtn {
        width: 1.5em;
        height: 1.5em;
        font-size: 1.5em;
        margin: 0;
        padding: 0;
        border: none;
        background: white;
        cursor: pointer;
        line-height: 1;
    }
    .chummer-import .import-container {
        flex-direction: column; 
        display: flex;
        padding: 0.5em 1em;
    }
    .chummer-import .import-panel {
        flex: 1;
        padding: 1em;
        border: 1px solid var(--color-border-light-tertiary, #ccc);
        border-radius: 8px;
        display: flex;
        flex-direction: column;
    }
    .chummer-import .import-panel p { flex-grow: 1; margin: 0.5em 0 1em 0; }
    .chummer-import code { background-color: #e0e0e0; padding: 0.1em 0.4em; border-radius: 4px; }

    .import-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5em;
    }

    .import-grid .cell {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .file-input-wrapper {
        width: 100%;
    }

    .file-input-label {
        display: block;
        padding: 0.5em;
        border: 1px solid #aaa;
        border-radius: 6px;
        text-align: center;
        cursor: pointer;
        background-color: #fafafa;
    }
    .file-input-label:hover { border-color: #a0c4e4; }

    #quickImportBtn, #advanceImportBtn {
        font-size: 1em;
        border: 1px solid #aaa;
        border-radius: 5px;
        padding: 0.2em;
        background-color: #eaeaea;
        cursor: pointer;
    }
    button.disabled { opacity: 0.6; cursor: not-allowed; pointer-events: none; }
    /* --- Status Footer --- */
    .import-status-footer { padding: 0.5em 0; }
    .progress-bar-container { width: 100%; background-color: #e0e0e0; border-radius: 5px; overflow: hidden; height: 8px; }
    .progress-bar { height: 100%; background-color: #4caf50; width: 0%; transition: width 0.3s ease; }
    .status-text { text-align: center; font-size: 0.9em; font-weight: 500; margin-bottom: 0.5em; }

    /* --- Settings Modal --- */
    .import-options-modal {
        position: fixed; inset: 0; background: rgba(0, 0, 0, 0.6);
        display: none; justify-content: center; align-items: center; z-index: 1000;
    }
    .import-options-modal.show { display: flex; }
    /* MODIFIED: Set max-height and removed padding to allow for internal scrolling */
    .import-options-content {
        background: var(--color-background-content, #fff);
        border-radius: 10px;
        width: 900px;
        max-width: 90vw;
        max-height: 85vh; /* Set max height to 85% of viewport */
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.25);
        display: flex;
        flex-direction: column;
    }
    /* MODIFIED: Added padding to header/footer and prevented them from shrinking */
    .import-options-content .modal-header,
    .import-options-content .modal-footer {
        padding: 1em 1.5em;
        flex-shrink: 0;
    }
    .import-options-content .modal-header { display: flex; justify-content: space-between; align-items: center; }
    .import-options-content h2, .import-options-content h3 { margin: 0; font-weight: bold; }
    /* MODIFIED: The body will now grow and scroll if content exceeds the modal's max-height */
    .import-options-content .modal-body {
        overflow-y: auto;
        flex-grow: 1;
        padding: 1em 1.5em;
    }
    .book-options-actions { padding: 0.5em; display: flex; justify-content: space-between; gap: 1em; }
    .book-options-actions button { font-size: 0.85em;  }
    .book-checkbox-grid, .other-settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 0.5em 1.5em; margin-top: 0.5em; margin-bottom: 1.5em;
    }
    .other-settings-grid { grid-template-columns: 1fr; gap: 0.8em; }
    .book-checkbox-grid label, .other-settings-grid label { display: flex; align-items: center; gap: 0.6em; }
    .import-options-content .modal-footer { display: flex; justify-content: flex-end; border-top: 1px solid #eee; }
    .hidden { display: none !important; }
</style>
